<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VINHMODLAG V65 - ULTIMATE SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00a884; --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; --border: #e4e6eb; --header: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        
        /* AUTH */
        #authScreen { position: fixed; inset: 0; background: var(--accent); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: var(--card); padding: 35px; border-radius: 25px; width: 380px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }

        /* HEADER */
        header { position: fixed; top:0; width:100%; height:75px; background: var(--header); display:flex; align-items:center; padding:0 25px; box-shadow:0 2px 15px rgba(0,0,0,0.1); z-index:1000; box-sizing:border-box; }
        .logo { font-weight:900; font-size: 26px; color:var(--accent); cursor: pointer; }
        .wallet { background:#1a1a1a; color:#00ff88; padding:8px 18px; border-radius:30px; font-weight:bold; margin-left:auto; border: 2px solid var(--accent); font-family: monospace; }

        /* SHOP GRID */
        .container { margin-top:100px; padding:20px; max-width:1100px; margin-inline:auto; }
        .shop-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(320px, 1fr)); gap:20px; }
        .product-card { background: var(--card); padding:20px; border-radius:20px; border:1px solid var(--border); text-align:center; transition: 0.3s; }
        .stock-badge { font-size: 11px; background: #f0f2f5; padding: 10px; border-radius: 12px; text-align: left; margin-bottom: 15px; border-left: 3px solid var(--accent); line-height: 1.5; }

        input, select, button, textarea { width:100%; padding:13px; margin:8px 0; border-radius:10px; border:1px solid var(--border); box-sizing: border-box; outline: none; font-family: inherit; }
        .btn-buy { background:var(--accent); color:#fff; border:none; font-weight:bold; cursor:pointer; text-transform:uppercase; }
        
        /* SIDE MENU & ROBOT */
        #sideMenu { position:fixed; top:0; left:-450px; width:380px; height:100%; background: var(--card); z-index:2000; padding:25px; transition:0.4s; box-shadow:15px 0 40px rgba(0,0,0,0.3); overflow-y:auto; box-sizing:border-box; }
        #robotConsole { background: #000; color: #0f8; padding: 15px; border-radius: 15px; font-family: monospace; margin-top: 15px; }
        #robotLogs { height: 180px; overflow-y: auto; font-size: 10px; border-bottom: 1px solid #222; margin-bottom: 10px; text-align: left; }

        /* MODALS */
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:5000; align-items:center; justify-content:center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card); padding:30px; border-radius:25px; width:450px; text-align:center; }
        .key-box { background: #333; padding: 15px; border-radius: 10px; color: #0f8; font-family: monospace; margin: 15px 0; max-height: 150px; overflow-y: auto; white-space: pre-wrap; text-align: left; }
        
        #overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1500; }
        .hist-item { background: #f8f9fa; padding: 12px; border-radius: 12px; margin-bottom: 8px; border-left: 5px solid var(--accent); text-align: left; }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="auth-box">
            <h1 style="color:var(--accent); font-weight:900;">VINHMODLAG</h1>
            <div id="formLogin">
                <input type="text" id="uLog" placeholder="T√™n t√†i kho·∫£n...">
                <input type="password" id="pLog" placeholder="M·∫≠t kh·∫©u...">
                <button class="btn-buy" onclick="handleLogin()">V√ÄO H·ªÜ TH·ªêNG</button>
                <p onclick="switchAuth('reg')" style="font-size:12px; cursor:pointer; color:var(--accent);">ƒêƒÉng k√Ω ngay</p>
            </div>
            <div id="formReg" style="display:none;">
                <input type="text" id="uReg" placeholder="T·∫°o t√†i kho·∫£n...">
                <input type="password" id="pReg" placeholder="M·∫≠t kh·∫©u...">
                <button class="btn-buy" style="background:#333;" onclick="handleRegister()">ƒêƒÇNG K√ù</button>
                <p onclick="switchAuth('login')" style="font-size:12px; cursor:pointer;">Quay l·∫°i ƒëƒÉng nh·∫≠p</p>
            </div>
        </div>
    </div>

    <div id="app" style="display:none">
        <header>
            <div onclick="toggleMenu(true)" style="font-size:25px; cursor:pointer; color: var(--accent);">‚ò∞</div>
            <div class="logo" style="margin-left:15px;">VINHMODLAG</div>
            <div class="wallet"><span id="userBal">0</span>ƒë</div>
        </header>

        <div id="sideMenu">
            <h2>S·∫øp: <span id="uNameDisp" style="color:var(--accent)"></span></h2>
            <button class="btn-buy" style="background:#333; font-size:12px;" onclick="openModal('modalHistory')">üìä L·ªäCH S·ª¨ MUA</button>
            <hr>
            <p style="font-size: 11px; font-weight:bold;">N·∫†P TI·ªÄN:</p>
            <select id="payMode" onchange="switchPay(this.value)">
                <option value="bank">Ng√¢n H√†ng (QR)</option>
                <option value="the">Th·∫ª C√†o (Card)</option>
            </select>

            <div id="payBank">
                <input type="number" id="bankAmt" placeholder="S·ªë ti·ªÅn...">
                <button class="btn-buy" style="background:#0066ff" onclick="genQR()">T·∫†O QR</button>
                <div id="qrBox" style="display:none; margin-top:10px;"><img id="qrImg" style="width:100%;"><p id="qrMsg" style="color:red; font-size:11px;"></p></div>
            </div>

            <div id="payThe" style="display:none;">
                <select id="cardType"><option>Viettel</option><option>Mobifone</option><option>Vinaphone</option></select>
                <select id="cardValue"><option value="10000">10k</option><option value="50000">50k</option><option value="100000">100k</option></select>
                <input id="cardPin" placeholder="M√£ PIN...">
                <input id="cardSeri" placeholder="S·ªë Seri...">
                <button class="btn-buy" onclick="submitCard()">G·ª¨I TH·∫∫ DUY·ªÜT</button>
            </div>

            <div id="adminArea" style="display:none;">
                <div id="robotConsole">
                    <b>üñ•Ô∏è ROBOT VINHMOD (G√µ .help)</b>
                    <div id="robotLogs">Ready...</div>
                    <input id="robotInput" placeholder="L·ªánh admin...">
                    <button onclick="runRobotCmd()" style="background:#0f8; color:#000;">TH·ª∞C THI</button>
                    <button onclick="openModal('modalKey')" style="background:#444; color:#fff; font-size:10px; margin-top:5px;">üì¶ N·∫†P KHO</button>
                </div>
            </div>
            <button onclick="logout()" style="color:red; background:none; border:1px solid red; margin-top:20px;">ƒêƒÇNG XU·∫§T</button>
        </div>

        <div class="container">
            <div class="shop-grid" id="shopGrid"></div>
        </div>
    </div>

    <div id="modalSuccess" class="modal"><div class="modal-content" style="background:#1a1a1a; color:#fff; border:2px solid #0f8;">
        <h2 style="color:#0f8;">MUA TH√ÄNH C√îNG! ‚úÖ</h2>
        <p id="succQty" style="font-size:13px;"></p>
        <div class="key-box" id="succKey"></div>
        <button class="btn-buy" style="background:#0f8; color:#000;" onclick="copyKey()">SAO CH√âP T·∫§T C·∫¢</button>
        <button onclick="closeModal('modalSuccess')" style="color:#aaa; background:none; border:none; margin-top:10px; cursor:pointer;">ƒê√ìNG</button>
    </div></div>

    <div id="modalKey" class="modal"><div class="modal-content">
        <h3>üì¶ N·∫†P KHO</h3>
        <select id="kProd"><option value="itachi">Itachi Ping V3</option><option value="hopper">Hopper Plus</option></select>
        <select id="kTime"><option>1 Ng√†y</option><option>7 Ng√†y</option><option>30 Ng√†y</option><option>Vƒ©nh Vi·ªÖn</option></select>
        <textarea id="kInput" rows="5" placeholder="M·ªói d√≤ng 1 m√£..."></textarea>
        <button class="btn-buy" onclick="adminAddStock()">N·∫†P KHO</button>
        <button onclick="closeModal('modalKey')">H·ª¶Y</button>
    </div></div>

    <div id="modalHistory" class="modal"><div class="modal-content">
        <h3>üìä L·ªäCH S·ª¨</h3>
        <div id="historyDisplay" style="max-height: 400px; overflow-y: auto;"></div>
        <button onclick="closeModal('modalHistory')">ƒê√ìNG</button>
    </div></div>

    <div id="overlay" onclick="toggleMenu(false)"></div>

    <script>
        const STORAGE_KEY = 'VINHMOD_V65_DB';
        const SESSION_KEY = 'VINHMOD_V65_SS';

        let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
            users: { "vinhmoddz": { pass: "vinhmoddz", bal: 10000000, admin: true, buys: [] } },
            napHistory: [], pendingCards: [],
            prods: [
                { id: 0, slug: "itachi", name: "Itachi Ping V3", plans: { "1 Ng√†y": 10000, "7 Ng√†y": 50000, "30 Ng√†y": 150000, "Vƒ©nh Vi·ªÖn": 500000 }, stock: { "1 Ng√†y": [], "7 Ng√†y": [], "30 Ng√†y": [], "Vƒ©nh Vi·ªÖn": [] } },
                { id: 1, slug: "hopper", name: "Hopper Plus", plans: { "1 Ng√†y": 15000, "7 Ng√†y": 70000, "30 Ng√†y": 200000, "Vƒ©nh Vi·ªÖn": 700000 }, stock: { "1 Ng√†y": [], "7 Ng√†y": [], "30 Ng√†y": [], "Vƒ©nh Vi·ªÖn": [] } }
            ]
        };

        let curUser = localStorage.getItem(SESSION_KEY) || null;
        function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); if(curUser) renderShop(); }
        
        // AUTO-SAVE khi tho√°t
        window.onbeforeunload = function() { save(); };

        function renderShop() {
            document.getElementById('userBal').innerText = db.users[curUser].bal.toLocaleString();
            let grid = document.getElementById('shopGrid'); grid.innerHTML = "";
            db.prods.forEach(p => {
                let sTxt = Object.keys(p.stock).map(k => `<b>${k}:</b> ${p.stock[k].length}`).join(' | ');
                grid.innerHTML += `<div class="product-card">
                    <div class="stock-badge">${sTxt}</div>
                    <h2>${p.name}</h2>
                    <select id="plan-${p.id}">${Object.keys(p.plans).map(k=>`<option value="${k}">${k} - ${p.plans[k].toLocaleString()}ƒë</option>`).join('')}</select>
                    <input type="number" id="qty-${p.id}" value="1" min="1" placeholder="S·ªë l∆∞·ª£ng mua...">
                    <button class="btn-buy" onclick="buyProcess(${p.id})">MUA NGAY</button>
                </div>`;
            });
        }

        function buyProcess(id) {
            let p = db.prods[id], 
                plan = document.getElementById(`plan-${id}`).value, 
                qty = parseInt(document.getElementById(`qty-${id}`).value) || 0,
                totalCost = p.plans[plan] * qty;

            if(qty <= 0) return alert("S·ªë l∆∞·ª£ng kh√¥ng ƒë√∫ng!");
            if(db.users[curUser].bal < totalCost) return alert("B·∫°n kh√¥ng ƒë·ªß ti·ªÅn!");
            if(p.stock[plan].length < qty) return alert("Kho kh√¥ng ƒë·ªß s·ªë l∆∞·ª£ng b·∫°n c·∫ßn!");

            // X·ª¨ L√ù TR·ª™ KHO V√Ä TI·ªÄN T·ª∞ ƒê·ªòNG
            let results = [];
            for(let i=0; i<qty; i++) {
                results.push(p.stock[plan].shift());
            }
            db.users[curUser].bal -= totalCost;
            db.users[curUser].buys.unshift({ name: p.name, plan: plan, qty: qty, keys: results, t: new Date().toLocaleString() });
            
            save();
            document.getElementById('succQty').innerText = `B·∫°n ƒë√£ mua ${qty} x ${p.name} (${plan})`;
            document.getElementById('succKey').innerText = results.join("\n");
            openModal('modalSuccess');
        }

        // --- ROBOT SYSTEM ---
        function runRobotCmd() {
            let cmd = document.getElementById('robotInput').value.trim(), p = cmd.split(" "), log = document.getElementById('robotLogs');
            if(cmd === ".help") {
                log.innerHTML += `\n--- L·ªÜNH ADMIN ---
1. .duyet [t√™n] [s·ªë] duyet (N·∫°p ti·ªÅn)
2. .xem [t√™n] (Xem pass/ti·ªÅn)
3. .lichsunap (L·ªãch s·ª≠ n·∫°p)
4. .banggiaudich (Ki·ªÉm kho)
5. .checkthe (Duy·ªát th·∫ª c√†o)`;
            }
            else if(p[0] === ".duyet" && p[3] === "duyet") {
                let u = p[1], v = parseInt(p[2]);
                if(db.users[u]) { db.users[u].bal += v; db.napHistory.unshift({u,v,t:new Date().toLocaleString()}); log.innerHTML += `\n‚úÖ ƒê√£ c·ªông ${v}ƒë cho ${u}`; save(); }
            }
            else if(p[0] === ".checkthe") {
                let txt = "\n--- TH·∫∫ CH·ªú ---";
                db.pendingCards.forEach((c,i)=>txt+=`\n${i+1}. ${c.u}: ${c.type} ${c.val}ƒë | PIN: ${c.pin}`);
                log.innerHTML += txt || "\nTr·ªëng!";
            }
            else if(p[0] === ".banggiaudich") {
                let txt = "\n--- KHO H√ÄNG ---";
                db.prods.forEach(pr => Object.keys(pr.stock).forEach(plan => {if(pr.stock[plan].length > 0) txt += `\n${pr.name}-${plan}: ${pr.stock[plan].length} key`;}));
                log.innerHTML += txt;
            }
            log.scrollTop = log.scrollHeight; document.getElementById('robotInput').value = "";
        }

        // --- FUNCTIONS ---
        function submitCard() {
            let type = document.getElementById('cardType').value, val = document.getElementById('cardValue').value, pin = document.getElementById('cardPin').value;
            if(!pin) return alert("Nh·∫≠p PIN!");
            db.pendingCards.unshift({u:curUser, type, val, pin, t:new Date().toLocaleString()});
            save(); alert("ƒê√£ g·ª≠i! Ch·ªù admin duy·ªát.");
        }
        function handleLogin() {
            let u = document.getElementById('uLog').value, p = document.getElementById('pLog').value;
            if(db.users[u] && db.users[u].pass === p) { curUser = u; localStorage.setItem(SESSION_KEY, u); initApp(); }
            else alert("Sai th√¥ng tin!");
        }
        function handleRegister() {
            let u = document.getElementById('uReg').value, p = document.getElementById('pReg').value;
            if(u && !db.users[u]) { db.users[u] = {pass:p, bal:0, admin:false, buys:[]}; save(); switchAuth('login'); alert("Xong!"); }
        }
        function initApp() {
            document.getElementById('authScreen').style.display='none';
            document.getElementById('app').style.display='block';
            document.getElementById('uNameDisp').innerText = curUser;
            document.getElementById('adminArea').style.display = db.users[curUser].admin ? 'block' : 'none';
            renderShop();
        }
        function switchAuth(m) { document.getElementById('formLogin').style.display = m==='login'?'block':'none'; document.getElementById('formReg').style.display = m==='reg'?'block':'none'; }
        function genQR() { let amt = document.getElementById('bankAmt').value; document.getElementById('qrImg').src = `https://img.vietqr.io/image/MB-0364684151-compact2.jpg?amount=${amt}&addInfo=NAP ${curUser.toUpperCase()}`; document.getElementById('qrBox').style.display='block'; }
        function copyKey() { navigator.clipboard.writeText(document.getElementById('succKey').innerText); alert("ƒê√£ copy!"); }
        function toggleMenu(s) { document.getElementById('sideMenu').style.left = s?'0':'-450px'; document.getElementById('overlay').style.display = s?'block':'none'; }
        function openModal(id) { 
            document.getElementById(id).style.display = 'flex'; 
            if(id==='modalHistory') {
                let d = document.getElementById('historyDisplay'); d.innerHTML = "";
                db.users[curUser].buys.forEach(b => d.innerHTML += `<div class="hist-item"><b>${b.name} x${b.qty}</b><br><small>${b.keys.join(", ")}</small></div>`);
            }
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function adminAddStock() {
            let pr = db.prods.find(x => x.slug === document.getElementById('kProd').value);
            let raw = document.getElementById('kInput').value.trim();
            if(raw) { pr.stock[document.getElementById('kTime').value].push(...raw.split('\n')); save(); closeModal('modalKey'); alert("ƒê√£ n·∫°p!"); }
        }
        function switchPay(v) { document.getElementById('payThe').style.display = v==='the'?'block':'none'; document.getElementById('payBank').style.display = v==='bank'?'block':'none'; }
        function logout() { localStorage.removeItem(SESSION_KEY); location.reload(); }
        if(curUser) initApp();
    </script>
</body>
  </html>
  
